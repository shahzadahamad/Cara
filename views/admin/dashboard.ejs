<%- include('../layouts/header.ejs') -%>

  <link rel="stylesheet" href="/styleSheet/admin.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <div class="sidebar">
    <div class="logo"></div>
    <ul class="menu">
      <li class="active">
        <a href="/admin/dashboard">
          <i class="fa-solid fa-gauge-high"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li>
        <a href="#">
          <i class="fas fa-user"></i>
          <span>Profile</span>
        </a>
      </li>
      <li>
        <a href="/admin/user-detials">
          <i class="fa-solid fa-users"></i>
          <span>Users</span>
        </a>
      </li>
      <li>
        <a href="/admin/order-detials">
          <i class="fa-solid fa-check"></i>
          <span>Order</span>
        </a>
      </li>
      <li>
        <a href="/admin/products">
          <i class="fa-solid fa-cart-shopping"></i>
          <span>Products</span>
        </a>
      </li>
      <li>
        <a href="/admin/category">
          <i class="fa-solid fa-list"></i>
          <span>Category</span>
        </a>
      </li>
      <li class="logout">
        <a href="/admin/logout">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </a>
      </li>
    </ul>
  </div>

  <div class="main--content">
    <div class="header--wrapper">
      <img src="/images/logo.png" style="width: 140px; height: 40px;" alt="">
      <div class="user--info">
        <img src="/images/admin.png" alt="">
        <h4>
          <%= admins.username %>
        </h4>
      </div>
    </div>
    <div class="card--container">
      <h3 class="main--title">Revenue</h3>
      <div class="card--wrapper">


        <div class="payment--card light-red">
          <div class="card--header">
            <div class="amount">
              <span class="title">Total Revenue</span>
              <span class="amount--value">₹<%= totalRevenue %></span>
            </div>
            <i class="fas fa-dollar-sign icon"></i>
          </div>
          <span class="card--detail">**** **** ****</span>
        </div>



        <div class="payment--card light-purple">
          <div class="card--header">
            <div class="amount">
              <span class="title">Daily Revenue</span>
              <span class="amount--value">₹<%=dailyRevenue%></span>
            </div>
            <i class="fas fa-dollar-sign icon dark-purple"></i>
          </div>
          <span class="card--detail">**** **** ****</span>
        </div>

        <div class="payment--card light-green">
          <div class="card--header">
            <div class="amount">
              <span class="title">Monthly Revenue</span>
              <span class="amount--value">₹<%=monthlyRevenue%></span>
            </div>
            <i class="fas fa-dollar-sign icon dark-green"></i>
          </div>
          <span class="card--detail">**** **** ****</span>
        </div>

        <div class="payment--card light-blue">
          <div class="card--header">
            <div class="amount">
              <span class="title">Yearly Revenue</span>
              <span class="amount--value">₹<%=yearlyRevenue%></span>
            </div>
            <i class="fas fa-dollar-sign icon dark-blue"></i>
          </div>
          <span class="card--detail">**** **** ****</span>
        </div>
      </div>
    </div>
    <div class="tabular--wrapper">
      <h3 class="main--title">Sale Report</h3>
      <div style="overflow-x: auto;" class="table--container">
        <div style="width: 160vh;">
          <canvas width="100" style="display: flex;" id="myChart"></canvas>
          <div style="display: flex; justify-content: center;" class="gap-3 mt-4 ">
            <button id="dailyBtn" class="btn btn-outline-primary">Daily</button>
            <button id="monthlyBtn" class="btn btn-outline-primary">Monthly</button>
            <button id="yearlyBtn" class="btn btn-outline-primary">Yearly</button>
            <a href="/admin/custom-sale-report" id="yearlyBtn" class="btn btn-outline-primary">Custom</a>
        </div>
        </div>
      </div>
    </div>
  </div>

  <script>
const ctx = document.getElementById('myChart');
const dailyBtn = document.getElementById('dailyBtn');
const monthlyBtn = document.getElementById('monthlyBtn');
const yearlyBtn = document.getElementById('yearlyBtn');

updateChart('daily');
dailyBtn.addEventListener('click', () => updateChart('daily'));
monthlyBtn.addEventListener('click', () => updateChart('monthly'));
yearlyBtn.addEventListener('click', () => updateChart('yearly'));



// fetching data
async function fetchData(url) {
  try {
    const response = await fetch(url,{
      method:'PATCH',
      headers:{
        'Content-Type':'application/json'
      },
    });
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return await response.json();
  } catch (error) {
    console.error(error.message);
  }
}


// updateing data
async function updateChart(dataType) {

  const data = await fetchData(`/admin/dashboard?type=${dataType}`);

  const { orders, revenue,cancelledOrder,type } = data;

  myChart.data.datasets[0].data=[orders];
  myChart.data.datasets[1].data=[revenue];
  myChart.data.datasets[2].data=[cancelledOrder];
  myChart.update();
}

const myChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Sun'],
    datasets: [
      {
        label: 'Orders',
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        data: [],
        borderWidth: 1
      },
      {
        label: 'Revenue',
        backgroundColor: 'rgba(255, 99, 132, 0.6)',
        data: [],
        borderWidth: 1,
      },
      {
        label: 'Cancelled_Order',
        backgroundColor: 'rgba(255, 0,0, 0.6)',
        data: [],
        borderWidth: 1,
      }
    ]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true
      },
    },
    elements: {
      bar: {
        borderWidth: 2,
        borderColor: 'rgba(0,0,0,0.9)'
      }
    }
  }
});


  </script> 



  <%- include('../layouts/footer.ejs') -%>